<template quantity=0>
  <button on:click="this.showPayment"><slot></slot></button>
</template>

<script>
  this.setState({
    quantity: 1
  })

  this.connected = () => {
    this.handler = StripeCheckout.configure({
      key: config.stripeKey,
      image: '',
      locale: 'auto',
      token: async (token) => {
        const response = await api('/payment', token)
      }
    })
  }

  this.showPayment = () => {
    const unitPrice = 15
    this.handler.open({
      name: 'Anthropedia',
      description: `${this.state.quantity} TCI tests`,
      amount: this.state.quantity * 100 * unitPrice
    })
  }
</script>

<style>
  .StripeElement {
    background-color: white;
    height: 40px;
    padding: 10px 12px;
    border-radius: 4px;
    border: 1px solid transparent;
    box-shadow: 0 1px 3px 0 #e6ebf1;
    -webkit-transition: box-shadow 150ms ease;
    transition: box-shadow 150ms ease;
  }

  .StripeElement--focus {
    box-shadow: 0 1px 3px 0 #cfd7df;
  }

  .StripeElement--invalid {
    border-color: #fa755a;
  }

  .StripeElement--webkit-autofill {
    background-color: #fefde5 !important;
  }
</style>
