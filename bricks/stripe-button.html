<template quantity=0>
  <slot on:click="this.showPayment"></slot>
</template>

<script>
  this.setState({
    quantity: 1
  })

  this.connected = () => {
    this.handler = StripeCheckout.configure({
      key: config.stripeKey,
      image: '',
      locale: 'auto',
      token: async (token) => {
        const response = await api('/payment', { data: { token, quantity: this.state.quantity }})
        if(!response.ok) alert("The payment could not be processed!")
        alert("Your purchase was successfully completed!")
        location.reload()  // TODO: refresh the user instead of hard reloading the page
      }
    })
  }

  this.showPayment = () => {
    const unitPrice = 15
    this.handler.open({
      name: 'Anthropedia',
      description: `${this.state.quantity} TCI tests`,
      amount: this.state.quantity * 100 * unitPrice
    })
  }
</script>

<style>
  root,
  slot {
    display: block;
    width: 100%;
    height: 100%;
  }
</style>
