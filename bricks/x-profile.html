<template>
  <main class=block>
    <h1><i class="fas fa-user-plus"></i> Edit Your Profile</h1>
    <form on:submit="this.save">
      <div class=row>
        <label>Name</label>
        <input name="name" value="${ user.name }" placeholder="Full name" required>
      </div>
      <div class=row>
        <label>Email</label>
        <input type="email" name="email" value="${ user.email }" placeholder="Email address" required>
      </div>
      <div class=row>
        <label>Password</label>
        <input type="password" name="password" value="">
      </div>
      <div class=row>
        <label>Password again</label>
        <input type="password" name="password_bis" value="">
      </div>

      <div class=row>
        <button class=primary>Save</button>
        <button type=reset>Cancel</button>
      </div>
    </form>
  </main>
</template>

<script>
  this.setState({})

  this.connected = async () => {
    this.render()
  }

  this.save = async (event) => {
    event.preventDefault()
    const form = event.currentTarget
    const data = {}
    Array.from(form.elements).filter(e => e.name && e.value).forEach(e => data[e.name] = e.value)
    if(data.password_bis !== data.password) return notify("Your 2 password must match!")
    const response = await api(`/user`, { data, method: 'PATCH' })
    if(response.ok) {
      notify('Info saved')
      window.user.fromData(response.data)
      page('/')
    }
    else notify(response.data)
  }
</script>

<style>
  @import url('/assets/css/main.css');
</style>
