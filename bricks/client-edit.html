<template id>
<div class=two-columns>
  <main class=block>
    <h1><x-icon figure=client-edit></x-icon>Edit profile</h1>
    <form on:submit="this.submit">

      <div class=row>
        <input name=name placeholder="Full Name*" value="${ this.client.name }" required>
      </div>

      <input class=row type=email name=email placeholder="Email" value="${ this.client.email }">

      <input class=row name=tags placeholder="Assigned Groups (insert multiple tag separated with a comma)" value="${ this.client.tags.join(', ') }" list=tags-list>
      <datalist id=tags-list>
        <option value=palm>
        <option value=st-patrick>
        <option value=archive>
      </datalist>

      <fieldset>
        <legend>Test informations</legend>
        <div class=row>
          <label>Language for the test</label>
          <select name=language>
            <option value=fr :selected="${ this.client.language == 'fr' }">French</option>
            <option value=en :selected="${ this.client.language == 'en' }">English</option>
          </select>
        </div>
        <div class=row>
          <label>Cultural Country</label>
          <select class=row name=culture>
            <option value=fr :selected="${ this.client.language == 'fr' }">France</option>
            <option value=us :selected="${ this.client.language == 'us' }">United States</option>
          </select>
        </div>
      </fieldset>

      <div class=row>
        <label>Notes</label>
        <textarea name=note>${ this.client.note }</textarea>
      </div>

      <footer class=toolbar>
        <button class=primary>Save</button>
        <a href=/ class=button>Cancel</a>
      </footer>
    </form>
  </main>

  <aside class="block">
    <h1><x-icon figure=file-medical-alt></x-icon>Assigned tests</h1>
    <ul>
      <li>
        <span><x-icon figure=clock color=#F5BA01></x-icon>pending since Jan 9th, 2019</span>
        <nav class=actions>
          <a href="mailto:agnano.vince@gmail.com?subject=A TCI test was assigned to you." title="Send the TCI by email to the Client">
            <x-icon figure=envelope></x-icon>
          </a>
          <a href=https://client.tci.anthropedia.org/123dsw title="Go to the TCI test form">
            <x-icon figure=file-signature></x-icon>
          </a>
          <x-icon figure=trash on:click="this.removeAssignement" title="Unassign this test from the Client"></x-icon>
        </nav>
      </li>
      <li>
        <span><x-icon figure=file-invoice></x-icon>completed on Aug 8th, 2016</span>
        <nav class=actions>
          <a class=score href=/score/123/1d>1D</a>
          <a class=score href=/score/123/1d>2D</a>
          <a class=score href=/score/123/1d>3D</a>
        </nav>
      </li>
    </ul>
    <button class=primary on:click="this.assign"><x-icon figure=file-medical></x-icon>Assign a new test</button>
  </aside>

</div>
</template>

<script>
  this.setState({
    id: null,
    client: { tags: [] },
  })

  this.connected = async () => {
    if(this.state.id) {
      const response = await api(`/client/${ this.state.id }`)
      this.state.client = response.data
    }
    this.render()
  }

  this.assign = async () => {
    const response = await api(`/client/${this.state.id}/assignment`, { method: 'post' })
    debugger
    this.render({ user: response.data })
  }

  this.removeAssignement = () => {
     if(!confirm('Are your sure you want to remove this assignment?')) return
     alert('Should delete this then!')
  }

  this.submit = (event) => {
    event.preventDefault()
    const form = event.currentTarget
    const data = {}
    Array.from(form.elements).filter(e => e.name).forEach(e => data[e.name] = e.value)
    api('/client', { data })
  }
</script>

<style>
  @import url('/assets/css/main.css');

  aside ul {
    padding: 0;
    list-style: none;
  }

  aside li {
    display: flex;
    justify-content: space-between;
    padding: .5rem 0;
    border-bottom: 1px solid #eee;
  }

  nav > * {
    display: inline-block;
    font-size: .7rem;
    font-weight: bold;
    width: 1.5rem;
    color: inherit;
    cursor: pointer;
    text-decoration: none;
    text-align: center;
    padding: .2rem;
    border-radius: .2rem;
    border: 1px solid transparent;
  }
  nav > *:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
  }

  aside button {
    width: 100%;
    margin-top: 1rem;
  }

  a.score {
  }
</style>
